---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import { topics, getTopicsByLevel } from '../../data/topics';
import { getPostBySlug } from '../../data/posts';

const levels = [
  { key: 'beginner' as const, label: 'Beginner', color: 'var(--accent)' },
  { key: 'intermediate' as const, label: 'Intermediate', color: 'var(--accent-warm)' },
  { key: 'advanced' as const, label: 'Advanced', color: '#f87171' },
];
---

<BaseLayout
  title="Topics"
  description="Explore nine areas of AI ethics in education â€” from bias and privacy to power and human labour."
>
  <Hero
    title="Topics"
    subtitle="Explore the ethical dimensions of artificial intelligence through nine key areas, from beginner concepts to advanced critical analysis."
  />

  {levels.map(level => {
    const levelTopics = getTopicsByLevel(level.key);
    return levelTopics.length > 0 && (
      <section class="level-section stagger-in">
        <div class="container">
          <h2 class="level-heading" style={`--level-color: ${level.color}`}>{level.label}</h2>
          <div class="topic-grid">
            {levelTopics.map(topic => {
              const firstArticle = topic.articleSlugs.length > 0 ? getPostBySlug(topic.articleSlugs[0]) : undefined;
              const coverImage = firstArticle?.coverImage;
              return (
                <a href={`/topics/${topic.slug}/`} class="topic-card">
                  {coverImage && (
                    <div class="topic-card-image">
                      <img src={coverImage} alt={`Cover image for ${topic.name}`} loading="lazy" />
                    </div>
                  )}
                  {!coverImage && <div class="topic-card-accent"></div>}
                  <div class="topic-card-content">
                    <div class="topic-card-meta">
                      <span class="topic-level-badge" style={`--level-color: ${level.color}`}>{level.label}</span>
                      <span class="topic-article-count">{topic.articleSlugs.length} {topic.articleSlugs.length === 1 ? 'article' : 'articles'}</span>
                    </div>
                    <h3 class="topic-card-title">{topic.name}</h3>
                    <p class="topic-card-desc">{topic.description}</p>
                  </div>
                </a>
              );
            })}
          </div>
        </div>
      </section>
    );
  })}
</BaseLayout>

<style>
  .level-section {
    padding-bottom: var(--space-lg);
  }

  .level-heading {
    font-family: var(--font-body);
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--level-color, var(--accent));
    margin-bottom: var(--space-md);
    font-weight: 600;
    padding-bottom: var(--space-xs);
    border-bottom: 1px solid var(--divider-accent);
    display: inline-block;
  }

  .topic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: var(--space-md);
  }

  @media (max-width: 640px) {
    .topic-grid {
      grid-template-columns: 1fr;
    }
  }

  .topic-card {
    display: block;
    position: relative;
    background: var(--bg-card);
    border-radius: 16px;
    overflow: hidden;
    transition: transform var(--transition), box-shadow var(--transition);
    color: var(--text);
    height: 100%;
    opacity: 0;
    animation: fadeInUp 0.6s var(--ease-out) forwards;
  }

  .topic-card:nth-child(1) { animation-delay: 0.05s; }
  .topic-card:nth-child(2) { animation-delay: 0.12s; }
  .topic-card:nth-child(3) { animation-delay: 0.19s; }
  .topic-card:nth-child(4) { animation-delay: 0.26s; }

  .topic-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    z-index: 2;
    padding: 1px;
    background: conic-gradient(
      from 45deg,
      var(--conic-bright) 0deg,
      var(--conic-dim) 45deg,
      var(--conic-bright) 90deg,
      var(--conic-dim) 135deg,
      var(--conic-bright) 180deg,
      var(--conic-dim) 225deg,
      var(--conic-bright) 270deg,
      var(--conic-dim) 315deg,
      var(--conic-bright) 360deg
    );
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
  }

  .topic-card:hover {
    transform: scale(1.02) translateY(-2px);
    box-shadow: var(--card-shadow);
  }

  .topic-card-image {
    width: 100%;
    height: 160px;
    overflow: hidden;
    position: relative;
  }

  .topic-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
    transition: transform 0.6s var(--ease-out);
  }

  .topic-card:hover .topic-card-image img {
    transform: scale(1.05);
  }

  .topic-card-image::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: linear-gradient(to bottom, transparent, var(--card-gradient-fade));
    pointer-events: none;
  }

  .topic-card-accent {
    height: 3px;
    background: linear-gradient(90deg, var(--accent), var(--accent-warm));
    position: relative;
    z-index: 3;
  }

  .topic-card-content {
    padding: var(--space-md);
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .topic-card-meta {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .topic-level-badge {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.2rem 0.5rem;
    border-radius: 100px;
    background: color-mix(in srgb, var(--level-color, var(--accent)) 15%, transparent);
    color: var(--level-color, var(--accent));
    font-weight: 600;
  }

  .topic-article-count {
    color: var(--text-muted);
  }

  .topic-card-title {
    font-size: 1.25rem;
    line-height: 1.3;
    margin-top: 0.25rem;
    transition: color var(--transition-fast);
  }

  .topic-card:hover .topic-card-title {
    color: var(--accent-hover);
  }

  .topic-card-desc {
    color: var(--text-muted);
    font-size: 0.9375rem;
    line-height: 1.6;
    margin-bottom: 0;
  }
</style>
